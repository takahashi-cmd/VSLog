{% extends "base.html" %}
{% block head_link %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/study.css') }}">
    <script src="{{ url_for('static', filename='js/common.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/study_logs.js') }}" defer></script>
{% endblock %}

{% block title %} å­¦ç¿’è¨˜éŒ²ã®ç™»éŒ²ãƒ»ç·¨é›† {% endblock %}

{% block content %}
<div class="main-container">
    <div class="study-inner">
        <div class="study-head">
            <h1>å­¦ç¿’è¨˜éŒ²ã®ç™»éŒ²ãƒ»ç·¨é›†</h1>
        </div>
        <!-- ç”»é¢è¡¨ç¤ºæ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="study-date">
            <p>{{ selected_date }}ã®å­¦ç¿’è¨˜éŒ²</p>
            <form action="{{ url_for('study_logs_view', user_id=current_user.user_id) }}" method="post" id="study-date-form">
                <label for="study_date">æ—¥ä»˜ï¼š</label>
                <input type="date" name="study_date" id="study_date" value="{{ selected_date }}">
            </form>
        </div>
        <!-- å­¦ç¿’è¨˜éŒ²ç™»éŒ²ãƒ»ç·¨é›†æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="study-form">
            <form class="study_logs_process" action="{{ url_for('study_logs_process', user_id=current_user.user_id) }}" method="post" name="study_logs_process">
                <div class="study-table-container">
                <table class="study-logs" id="study-logs">
                    <thead>
                        <tr class="study-tr logs">
                            <th class="th-num">No.</th>
                            <th class="th-hour">å­¦ç¿’æ™‚é–“</th>
                            <th class="th-fieldname">åˆ†é‡å</th>
                            <th class="th-content">å†…å®¹</th>
                            <th class="th-delete">å‰Šé™¤</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- å­¦ç¿’ãƒ­ã‚°ãŒã‚ã‚‹å ´åˆã¯ãƒ«ãƒ¼ãƒ—ã§è¡¨ç¤º -->
                        {% for study_log in study_logs %}
                            <tr class="study-tr logs">
                                <td class="table-num">{{ loop.index }}</td>
                                <td class="table-hour"><input type="number" step="0.1" min="0" max="24" name="hours[]" value="{{ study_log.hour }}"></td>
                                <td class="table-fieldname">
                                    <input type="text" name="fieldname[]" value="{{ study_log.fields.fieldname }}" list="field_list">
                                    <datalist id="field_list">
                                        {% for field in current_user.fields %}
                                        <option value="{{ field.fieldname }}"></option>
                                        {% endfor %}
                                    </datalist>
                                </td>
                                <td class="table-content"><textarea name="contents[]" rows="" cols="">{{ study_log.content }}</textarea></td>
                                <td class="table-delete">
                                    <input type="hidden" name="study_dates[]" value="{{ selected_date }}">
                                    <input type="hidden" name="study_log_id[]" value="{{ study_log.study_log_id }}">
                                    <input type="hidden" name="row_action[]" value="update">
                                    <button class="delete-button" type="button" onclick="markDeleted(this)">ğŸ—‘ï¸</button>
                                </td>
                            </tr>
                        {% endfor %}

                        <!-- ç©ºè¡Œã®è¨˜å…¥æ¬„ã®è¡¨ç¤ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯5è¡Œè¡¨ç¤ºï¼‰ -->
                        {% for i in range(5 - study_logs|length) %}
                        <tr class="study-tr logs">
                            <td class="table-num">{{ study_logs|length + i + 1 }}</td>
                            <td class="table-hour"><input type="number" step="0.1" min="0" max="24" name="hours[]" value=""></td>
                            <td class="table-fieldname">
                                <input type="text" name="fieldname[]" value="" list="field_list2">
                                <datalist id="field_list2" data-fieldname="{{ current_user.fields }}">
                                    {% for field in current_user.fields %}
                                    <option value="{{ field.fieldname }}"></option>
                                    {% endfor %}
                                </datalist>
                            </td>
                            <td class="table-content"><textarea name="contents[]" rows="" cols=""></textarea></td>
                            <td class="table-delete">
                                <input type="hidden" name="study_dates[]" id="selected_date" data-selected-date="{{ selected_date }}" value="{{selected_date}}">
                                <input type="hidden" name="study_log_id[]" value="">
                                <input type="hidden" name="row_action[]" value="new">
                                <button class="delete-button" type="button" onclick="removeRow(this)">ğŸ—‘ï¸</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                </div>
                <div class="study-button">
                    <button type="submit">æ›´æ–°</button>
                    <button type="button" onclick="addRowLogs(this)">è¨˜å…¥æ¬„ã‚’è¿½åŠ ã™ã‚‹</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}