{% extends "base.html" %}
{% block head_link %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/study.css') }}">
    <script src="{{ url_for('static', filename='js/study_edit.js') }}"></script>
{% endblock %}

{% block title %} å­¦ç¿’è¨˜éŒ²ã®ç™»éŒ²ãƒ»ç·¨é›† {% endblock %}

{% block header %}
<div class="header-nav">
    <a href="{{ url_for('index_view', user_id=current_user.user_id) }}">ãƒ›ãƒ¼ãƒ </a>
    <a href="{{ url_for('profile_edit_view', user_id=current_user.user_id) }}">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
    <a href="{{ url_for('study_logs_view', user_id=current_user.user_id) }}">å­¦ç¿’è¨˜éŒ²ã®ç™»éŒ²ãƒ»ç·¨é›†</a>
    <a href="{{ url_for('study_fields_view', user_id=current_user.user_id) }}">å­¦ç¿’åˆ†é‡ã®ç™»éŒ²ãƒ»ç·¨é›†</a>
    <a href="{{ url_for('study_logs_list', user_id=current_user.user_id) }}">å­¦ç¿’å±¥æ­´ã®ä¸€è¦§</a>
    <form action="{{ url_for('logout') }}" method="get">
        <button class="logout" type="submit">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </form>
</div>
{% endblock %}

{% block content %}
<div class="flash-messsage">
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="flashes">
        {% for message in messages %}
        <p>{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
</div>

<div class="main-container">
    <div class="study-inner">
        <div class="study-head">
            <h1>å­¦ç¿’è¨˜éŒ²ã®ç™»éŒ²ãƒ»ç·¨é›†</h1>
        </div>
        <div class="study-form">
            <form class="study_logs_process" action="{{ url_for('study_logs_process', user_id=current_user.user_id) }}" method="post">
                <div class="study-table">
                <table>
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>æ—¥ä»˜</th>
                            <th>å­¦ç¿’æ™‚é–“</th>
                            <th>åˆ†é‡å</th>
                            <th>å†…å®¹</th>
                            <th>å‰Šé™¤</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- å­¦ç¿’ãƒ­ã‚°ãŒã‚ã‚‹å ´åˆã¯ãƒ«ãƒ¼ãƒ—ã§è¡¨ç¤º -->
                        {% for study_log in current_user.study_logs %}
                            <tr>
                                <td class="table-num">{{ loop.index }}</td>
                                <td><input type="date" name="study_dates[]" value="{{ study_log.study_date or '' }}"></td>
                                <td><input type="number" step="0.1" min="0" max="24" name="hours[]" value="{{ study_log.hour or '' }}"></td>
                                <td>
                                    <input type="text" name="fieldname[]" value="{{ study_log.fields.fieldname }}" list="field_list">
                                    <datalist id="field_list">
                                        {% for field in current_user.fields %}
                                        <option value="{{ field.fieldname }}"></option>
                                        {% endfor %}
                                    </datalist>
                                </td>
                                <td><textarea name="contents[]">{{ study_log.content or '' }}</textarea></td>
                                <td>
                                    <input type="hidden" name="study_log_id[]" value="{{ study_log.study_log_id }}">
                                    <input type="hidden" name="row_action[]" value="update">
                                    <button class="delete-button" type="button" onclick="markDeleted(this)">ğŸ—‘ï¸</button>
                                </td>
                            </tr>
                        {% endfor %}

                        <!-- ç©ºè¡Œã®è¨˜å…¥æ¬„ã®è¡¨ç¤ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯5è¡Œè¡¨ç¤ºï¼‰ -->
                        {% for i in range(3) %}
                        <tr>
                            <td class="table-num">{{ current_user.study_logs|length + i + 1 }}</td>
                            <td><input type="date" name="study_dates[]" value=""></td>
                            <td><input type="number" step="0.1" min="0" max="24" name="hours[]" value=""></td>
                            <td>
                                <input type="text" name="fieldname[]" value="" list="field_list2">
                                <datalist id="field_list2">
                                    {% for field in current_user.fields %}
                                    <option value="{{ field.fieldname }}"></option>
                                    {% endfor %}
                                </datalist>
                            </td>
                            <td><textarea name="contents[]"></textarea></td>
                            <td>
                                <input type="hidden" name="study_log_id[]" value="">
                                <input type="hidden" name="row_action[]" value="new">
                                <button class="delete-button" type="button" onclick="removeRow(this)">ğŸ—‘ï¸</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                </div>
                <div class="study-button">
                    <button type="submit">æ›´æ–°</button>
                    <button type="button" onclick="addRowLogs(this)">è¨˜å…¥æ¬„ã‚’è¿½åŠ ã™ã‚‹</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}